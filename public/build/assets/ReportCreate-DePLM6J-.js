import{h as v,T as F,e as L,d as o,o as a,b as g,i as r,Z as O,w as S,a as e,n as T,j as d,f as V,g as i,m as y,p as q,t as u,v as x,F as m,k as b,q as D}from"./app-B_Kj_3rO.js";import{_ as J}from"./AppLayout-5mzGF13c.js";import{_ as R}from"./NavPage-B_Lp_Yaa.js";import{C as W}from"./CodeEditor-B_o5Vn4Z.js";import{Q as z}from"./QuillEditor-CSlkHICf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"h-8 mt-8"},P={class:"flex items-center gap-1 md:gap-4"},G={key:0},I={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"},H={class:"block"},K={key:0,class:"text-red-600 text-sm"},X={class:"block"},Z={key:0,class:"text-red-600 text-sm"},Y={class:"block"},ee=["value"],te={key:0,class:"text-red-600 text-sm"},se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"},re={class:"block"},le={key:0,class:"text-red-600 text-sm"},oe={class:"block"},ae={key:0},ne={class:"block"},ue=["value"],de={key:1},ie={class:"block"},pe=["value"],ce={key:2},ye={class:"block"},me=["value"],ge={key:1},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},fe={class:"block"},ve={key:0,class:"text-red-600 text-sm"},xe={class:"flex items-end"},ke={class:"col-span-full"},he={key:0,class:"text-red-600 text-sm"},we={class:"col-span-full"},Te={key:0},_e={key:1,class:"overflow-auto max-h-96 border border-gray-200 rounded-md shadow-md"},Se={class:"min-w-full table-auto text-sm text-gray-700"},qe={class:"bg-gray-100 border-b border-gray-300"},Ce={key:2,class:"text-center text-gray-500 italic mt-2"},Ve={key:2},De={class:"space-y-2 text-sm"},Me={class:"text-blue-500"},$e={class:"text-blue-500"},Ae={class:"pt-6"},Qe={class:"block"},Ee={key:0,class:"text-red-600 text-sm"},Ue={key:3,class:"mt-8 flex flex-col sm:flex-row gap-4"},Ne={key:4,class:"mt-8 flex flex-col sm:flex-row gap-4"},je={type:"submit",form:"report",class:"bg-red-700 text-white px-4 py-2 rounded-md hover:bg-red-900 w-full sm:w-48"},ze={__name:"ReportCreate",props:{countReports:{type:String},query:{type:Array},groups:{type:[Object,Array]},success:{type:String},error:{type:String},customMessage:{type:String}},setup(k){const h=v(null),s=F({report_description:"",status:"",group_id:"",message:"",scheduleType:"",selectedTime:"",selectedWeekday:"",selectedDay:"",selectedMonth:"",query_name:"",query:""}),M=()=>{h.value=!0,s.post(route("report.store"),{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{s.reset(),console.log("Salvo com sucesso!"),h.value=null},onError:n=>{console.error("Erro ao enviar:",n),h.value=null}})},$=[{value:"0",label:"Domingo"},{value:"1",label:"Segunda-feira"},{value:"2",label:"Terça-feira"},{value:"3",label:"Quarta-feira"},{value:"4",label:"Quinta-feira"},{value:"5",label:"Sexta-feira"},{value:"6",label:"Sábado"}],A=[{value:"1",label:"Janeiro"},{value:"2",label:"Fevereiro"},{value:"3",label:"Março"},{value:"4",label:"Abril"},{value:"5",label:"Maio"},{value:"6",label:"Junho"},{value:"7",label:"Julho"},{value:"8",label:"Agosto"},{value:"9",label:"Setembro"},{value:"10",label:"Outubro"},{value:"11",label:"Novembro"},{value:"12",label:"Dezembro"}];[...Array(31).keys()].map(n=>n+1),L(()=>{if(!s.selectedTime)return"* * * * *";const[n,t]=s.selectedTime.split(":");return s.scheduleType==="daily"?`${t} ${n} * * *`:s.scheduleType==="weekly"?`${t} ${n} * * ${s.selectedWeekday}`:s.scheduleType==="monthly"?`${t} ${n} ${s.selectedDay} * *`:s.scheduleType==="yearly"?`${t} ${n} ${s.selectedDay} ${s.selectedMonth} *`:"* * * * *"});const p=v(1),_=n=>{p.value=n},Q=()=>{p.value<3&&(p.value=p.value+1)},E=v({query:s==null?void 0:s.query}),C=v(""),f=v(!1),w=v([]),U=()=>{if(f.value=!0,C.value="",!E.value.query.trim()){console.warn("A query está vazia."),f.value=!1;return}fetch(route("test.query"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"},body:JSON.stringify({query:s.query})}).then(async n=>{const t=await n.json();if(!n.ok){const l=t.query_error||t.connection_error||t.message||"Erro desconhecido.";throw new Error(l)}w.value=t.result,f.value=!1}).catch(n=>{C.value=n.message,f.value=!1,console.error("Erro:",n.message)})};return(n,t)=>(a(),o(m,null,[g(r(O),{title:"Criar relatório"}),g(J,{success:k.success,error:k.error,customMessage:k.customMessage},{default:S(()=>[g(R,{headTitle:"Criar novo relatório",countData:k.countReports,routeIndex:"report.index",routeSelect:"report.index",routeSearch:"report.search",routeCreate:"report.create"},null,8,["countData"]),e("div",null,[e("nav",B,[e("ul",P,[e("li",null,[e("span",{class:T(["text-xs md:text-base flex items-center",p.value===1?"px-5 py-3 bg-white border border-b-0 border-gray-300 cursor-default":"px-5 py-3 bg-gray-300 text-white cursor-pointer hover:bg-gray-200 hover:text-gray-600"]),onClick:t[0]||(t[0]=l=>_(1))},t[15]||(t[15]=[e("i",{class:"fa-solid fa-calendar-days"},null,-1),d(),e("span",{class:"hidden md:block md:ms-4"},"Agendamento",-1)]),2)]),e("li",null,[e("span",{class:T(["text-xs md:text-base flex items-center",p.value===2?"px-5 py-3 bg-white border border-b-0 border-gray-300 cursor-default":"px-5 py-3 bg-gray-300 text-white cursor-pointer hover:bg-gray-200 hover:text-gray-600"]),onClick:t[1]||(t[1]=l=>_(2))},t[16]||(t[16]=[e("i",{class:"fa-solid fa-database"},null,-1),d(),e("span",{class:"hidden md:block md:ms-4"},"Consulta SQL",-1)]),2)]),e("li",null,[e("span",{class:T(["text-xs md:text-base flex items-center",p.value===3?"px-5 py-3 bg-white border border-b-0 border-gray-300 cursor-default":"px-5 py-3 bg-gray-300 text-white cursor-pointer hover:bg-gray-200 hover:text-gray-600"]),onClick:t[2]||(t[2]=l=>_(3))},t[17]||(t[17]=[e("i",{class:"fa-solid fa-envelope-open-text"},null,-1),d(),e("span",{class:"hidden md:block md:ms-4"},"E-mail",-1)]),2)])])])]),e("form",{onSubmit:V(M,["prevent"]),id:"report",class:"bg-white p-4 border border-gray-300 rounded-t-none shadow-lg rounded-md mt-1 md:mt-4"},[p.value===1?(a(),o("div",G,[t[28]||(t[28]=e("h1",{class:"py-6 font-extrabold text-lg"},"Geral",-1)),e("div",I,[e("div",null,[e("label",H,[t[18]||(t[18]=e("span",{class:"text-gray-700"},[d("Título "),e("span",{class:"text-red-600"},"**")],-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>r(s).report_description=l),type:"text",required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500",placeholder:"Defina um título"},null,512),[[q,r(s).report_description]]),r(s).errors.report_description?(a(),o("p",K,u(r(s).errors.report_description),1)):i("",!0)])]),e("div",null,[e("label",X,[t[20]||(t[20]=e("span",{class:"text-gray-700"},[d("Status "),e("span",{class:"text-red-600"},"**")],-1)),y(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>r(s).status=l),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},t[19]||(t[19]=[e("option",{value:"1"},"Ativo",-1),e("option",{value:"0"},"Inativo",-1)]),512),[[x,r(s).status]]),r(s).errors.status?(a(),o("p",Z,u(r(s).errors.status),1)):i("",!0)])]),e("div",null,[e("label",Y,[t[21]||(t[21]=e("span",{class:"text-gray-700"},[d("Grupo de contatos "),e("span",{class:"text-red-600"},"**")],-1)),y(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>r(s).group_id=l),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},[(a(!0),o(m,null,b(k.groups,(l,c)=>(a(),o("option",{key:c,value:l.id},u(l.name),9,ee))),128))],512),[[x,r(s).group_id]]),r(s).errors.group_id?(a(),o("p",te,u(r(s).errors.group_id),1)):i("",!0)])])]),e("div",se,[e("div",null,[e("label",re,[t[23]||(t[23]=e("span",{class:"text-gray-700"},[d("Tipo de Agendamento "),e("span",{class:"text-red-600"},"**")],-1)),y(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>r(s).scheduleType=l),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},t[22]||(t[22]=[e("option",{value:"daily"},"Diariamente",-1),e("option",{value:"weekly"},"Semanalmente",-1),e("option",{value:"monthly"},"Mensalmente",-1),e("option",{value:"yearly"},"Anualmente",-1)]),512),[[x,r(s).scheduleType]]),r(s).errors.scheduleType?(a(),o("p",le,u(r(s).errors.scheduleType),1)):i("",!0)])]),e("div",null,[e("label",oe,[t[24]||(t[24]=e("span",{class:"text-gray-700"},[d("Horário "),e("span",{class:"text-red-600"},"**")],-1)),y(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>r(s).selectedTime=l),type:"time",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},null,512),[[q,r(s).selectedTime]])])]),r(s).scheduleType==="weekly"?(a(),o("div",ae,[e("label",ne,[t[25]||(t[25]=e("span",{class:"text-gray-700"},"Dia da semana",-1)),y(e("select",{"onUpdate:modelValue":t[8]||(t[8]=l=>r(s).selectedWeekday=l),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},[(a(),o(m,null,b($,(l,c)=>e("option",{key:c,value:l.value},u(l.label),9,ue)),64))],512),[[x,r(s).selectedWeekday]])])])):i("",!0),r(s).scheduleType==="monthly"||r(s).scheduleType==="yearly"?(a(),o("div",de,[e("label",ie,[t[26]||(t[26]=e("span",{class:"text-gray-700"},"Dia do mês",-1)),y(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>r(s).selectedDay=l),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},[(a(),o(m,null,b(31,l=>e("option",{key:l,value:l},u(l),9,pe)),64))],512),[[x,r(s).selectedDay]])])])):i("",!0),r(s).scheduleType==="yearly"?(a(),o("div",ce,[e("label",ye,[t[27]||(t[27]=e("span",{class:"text-gray-700"},"Mês do ano",-1)),y(e("select",{"onUpdate:modelValue":t[10]||(t[10]=l=>r(s).selectedMonth=l),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},[(a(),o(m,null,b(A,(l,c)=>e("option",{key:c,value:l.value},u(l.label),9,me)),64))],512),[[x,r(s).selectedMonth]])])])):i("",!0)])])):i("",!0),p.value===2?(a(),o("div",ge,[t[32]||(t[32]=e("h1",{class:"py-6 font-extrabold text-lg"},"Consulta SQL",-1)),e("div",be,[e("div",null,[e("label",fe,[t[29]||(t[29]=e("span",{class:"text-gray-700"},[d("Nome "),e("span",{class:"text-red-600"},"**")],-1)),y(e("input",{"onUpdate:modelValue":t[11]||(t[11]=l=>r(s).query_name=l),type:"text",required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500",placeholder:"Defina um nome"},null,512),[[q,r(s).query_name]]),r(s).errors.query_name?(a(),o("p",ve,u(r(s).errors.query_name),1)):i("",!0)])]),e("div",xe,[e("form",{id:"query",onSubmit:V(U,["prevent"]),class:"w-full"},[t[30]||(t[30]=e("p",{class:"text-gray-700 mb-1"},"Testar consulta SQL",-1)),e("button",{class:T([f.value?"bg-indigo-900":"bg-indigo-600 hover:bg-indigo-700","w-full px-4 py-2 text-white rounded-md text-sm transition duration-300"]),form:"query",type:"submit"},u(f.value?"Consultando...":"Testar"),3)],32)]),e("div",ke,[t[31]||(t[31]=e("label",{class:"block"},[e("span",{class:"text-gray-700"},[d("Query SQL "),e("span",{class:"text-red-600"},"**")])],-1)),r(s).errors.query?(a(),o("p",he,u(r(s).errors.query),1)):i("",!0),g(W,{modelValue:r(s).query,"onUpdate:modelValue":t[12]||(t[12]=l=>r(s).query=l),class:"cursor-text",required:""},null,8,["modelValue"])]),e("div",we,[n.errorMsg?(a(),o("div",Te,u(n.errorMsg),1)):i("",!0),w.value?(a(),o("div",_e,[e("table",Se,[e("thead",qe,[e("tr",null,[(a(!0),o(m,null,b(w.value[0],(l,c)=>(a(),o("th",{key:c,class:"px-4 py-1 text-left text-xs uppercase text-gray-600"},u(c),1))),128))])]),e("tbody",null,[(a(!0),o(m,null,b(w.value,(l,c)=>(a(),o("tr",{key:c,class:"hover:bg-gray-50"},[(a(!0),o(m,null,b(l,(N,j)=>(a(),o("td",{key:j,class:"px-4 py-2 border-b"},u(N),1))),128))]))),128))])])])):(a(),o("div",Ce,"Nenhum dado encontrado."))])])])):i("",!0),p.value===3?(a(),o("div",Ve,[t[36]||(t[36]=e("h1",{class:"py-6 font-extrabold text-lg"},"E-mail",-1)),e("div",De,[e("p",null,[t[33]||(t[33]=d("Assunto: ")),e("span",Me,u(r(s).report_description),1)]),e("p",null,[t[34]||(t[34]=d("Tipo de agendamento: ")),e("span",$e,u(r(s).scheduleType),1)])]),e("div",Ae,[e("label",Qe,[t[35]||(t[35]=e("span",{class:"text-gray-700"},[d("Corpo do e-mail "),e("span",{class:"text-red-600"},"**")],-1)),r(s).errors.message?(a(),o("p",Ee,u(r(s).errors.message),1)):i("",!0)]),g(z,{modelValue:r(s).message,"onUpdate:modelValue":t[13]||(t[13]=l=>r(s).message=l)},null,8,["modelValue"])])])):i("",!0),p.value<3?(a(),o("div",Ue,[e("button",{onClick:t[14]||(t[14]=l=>Q()),type:"button",class:"bg-red-700 text-white px-4 py-2 rounded-md hover:bg-red-900 w-full sm:w-48"},t[37]||(t[37]=[d(" Próximo "),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])),g(r(D),{href:n.route("report.index"),class:"bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-900 flex justify-center items-center w-full sm:w-48"},{default:S(()=>t[38]||(t[38]=[e("i",{class:"fa-solid fa-trash-can me-2"},null,-1),d(" Cancelar ")])),_:1},8,["href"])])):i("",!0),p.value===3?(a(),o("div",Ne,[e("button",je,[t[39]||(t[39]=e("i",{class:"fa-solid fa-check"},null,-1)),d(" "+u(h.value?"Salvando...":"Salvar"),1)]),g(r(D),{href:n.route("report.index"),class:"bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-900 flex justify-center items-center w-full sm:w-48"},{default:S(()=>t[40]||(t[40]=[e("i",{class:"fa-solid fa-trash-can me-2"},null,-1),d(" Cancelar ")])),_:1},8,["href"])])):i("",!0)],32)]),_:1},8,["success","error","customMessage"])],64))}};export{ze as default};
