import{T as Y,e as ee,h,d as l,o as a,b,i as s,Z as te,w as T,a as e,n as _,j as u,f as R,g as p,m,p as S,t as i,v as x,F as g,k as f,q as z}from"./app-B_Kj_3rO.js";import{_ as re}from"./AppLayout-5mzGF13c.js";import{_ as se}from"./NavPage-B_Lp_Yaa.js";import{C as oe}from"./CodeEditor-B_o5Vn4Z.js";import{Q as le}from"./QuillEditor-CSlkHICf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"h-8 mt-8"},ne={class:"flex items-center gap-1 md:gap-4"},de={key:0},ue={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"},ie={class:"block"},pe={key:0,class:"text-red-600 text-sm"},ye={class:"block"},ce={key:0,class:"text-red-600 text-sm"},me={class:"block"},ge=["value"],be={key:0,class:"text-red-600 text-sm"},fe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"},ve={class:"block"},xe={key:0,class:"text-red-600 text-sm"},ke={class:"block"},he={key:0},we={class:"block"},_e=["value"],qe={key:1},Te={class:"block"},Se=["value"],$e={key:2},De={class:"block"},Ve=["value"],Ce={key:1},Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ae={class:"block"},Ee={key:0,class:"text-red-600 text-sm"},Qe={class:"flex items-end"},Ue={class:"col-span-full"},Ne={class:"block"},je={key:0,class:"text-red-600 text-sm"},Fe={class:"col-span-full"},Oe={key:0},Le={key:1,class:"overflow-auto max-h-96 border border-gray-200 rounded-md shadow-md"},We={class:"min-w-full table-auto text-sm text-gray-700"},Je={class:"bg-gray-100 border-b border-gray-300"},Re={key:2,class:"text-center text-gray-500 italic mt-2"},ze={key:2},Be={class:"space-y-2 text-sm"},Pe={class:"text-blue-500"},Ge={class:"text-blue-500"},Ie={class:"pt-6"},He={key:0,class:"text-red-600 text-sm"},Ke={key:3,class:"mt-8 flex flex-col sm:flex-row gap-4"},Xe={key:4,class:"mt-8 flex flex-col sm:flex-row gap-4"},ot={__name:"ReportEdit",props:{report:{type:[Object,Array],required:!0},countReports:{type:String},query:{type:Array},groups:{type:[Object,Array]},success:{type:String},error:{type:String}},setup(k){var D,V,C,M,A,E,Q,U,N,j,F,O,L,W,J;const d=k,r=Y({report_id:((D=d.report)==null?void 0:D.id)||"",report_token:((V=d.report)==null?void 0:V.report_token)||"",report_description:((C=d.report)==null?void 0:C.report_description)||"",status:((M=d.report)==null?void 0:M.status)||"",group_id:((A=d.report)==null?void 0:A.group_id)||"",message:((E=d.report)==null?void 0:E.message)||"",scheduleType:((Q=d.report)==null?void 0:Q.scheduleType)||"",selectedTime:((U=d.report)==null?void 0:U.selectedTime)||"",selectedWeekday:((N=d.report)==null?void 0:N.selectedWeekday)||"",selectedDay:((j=d.report)==null?void 0:j.selectedDay)||"",selectedMonth:((F=d.report)==null?void 0:F.selectedMonth)||"",query_id:((O=d.query)==null?void 0:O.id)||"",query_token:((L=d.query)==null?void 0:L.query_token)||"",query_name:((W=d.query)==null?void 0:W.query_name)||"",query:((J=d.query)==null?void 0:J.query)||""}),B=()=>{r.post(route("report.update"),{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{r.reset(),console.log("Salvo com sucesso!")},onError:n=>{console.error("Erro ao enviar:",n)}})},P=[{value:"0",label:"Domingo"},{value:"1",label:"Segunda-feira"},{value:"2",label:"Terça-feira"},{value:"3",label:"Quarta-feira"},{value:"4",label:"Quinta-feira"},{value:"5",label:"Sexta-feira"},{value:"6",label:"Sábado"}],G=[{value:"1",label:"Janeiro"},{value:"2",label:"Fevereiro"},{value:"3",label:"Março"},{value:"4",label:"Abril"},{value:"5",label:"Maio"},{value:"6",label:"Junho"},{value:"7",label:"Julho"},{value:"8",label:"Agosto"},{value:"9",label:"Setembro"},{value:"10",label:"Outubro"},{value:"11",label:"Novembro"},{value:"12",label:"Dezembro"}];[...Array(31).keys()].map(n=>n+1),ee(()=>{if(!r.selectedTime)return"* * * * *";const[n,t]=r.selectedTime.split(":");return r.scheduleType==="daily"?`${t} ${n} * * *`:r.scheduleType==="weekly"?`${t} ${n} * * ${r.selectedWeekday}`:r.scheduleType==="monthly"?`${t} ${n} ${r.selectedDay} * *`:r.scheduleType==="yearly"?`${t} ${n} ${r.selectedDay} ${r.selectedMonth} *`:"* * * * *"});const y=h(1),q=n=>{y.value=n},I=()=>{y.value<3&&(y.value=y.value+1)},H=h({query:r==null?void 0:r.query}),$=h(""),v=h(!1),w=h([]),K=()=>{if(v.value=!0,$.value="",!H.value.query.trim()){console.warn("A query está vazia."),v.value=!1;return}fetch(route("test.query"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"},body:JSON.stringify({query:r.query})}).then(async n=>{const t=await n.json();if(!n.ok){const o=t.query_error||t.connection_error||t.message||"Erro desconhecido.";throw new Error(o)}w.value=t.result,v.value=!1}).catch(n=>{$.value=n.message,v.value=!1,console.error("Erro:",n.message)})};return(n,t)=>(a(),l(g,null,[b(s(te),{title:`Editar relatório ${k.report.id}`},null,8,["title"]),b(re,{success:d.success,error:d.error},{default:T(()=>[b(se,{headTitle:`Editar relatório ${k.report.id}`,countData:k.countReports,routeIndex:"report.index",routeSelect:"report.index",routeSearch:"report.search",routeCreate:"report.create"},null,8,["headTitle","countData"]),e("div",null,[e("nav",ae,[e("ul",ne,[e("li",null,[e("span",{class:_(["text-xs md:text-base flex items-center",y.value===1?"px-5 py-3 bg-white border border-b-0 border-gray-300 cursor-default":"px-5 py-3 bg-gray-300 text-white cursor-pointer hover:bg-gray-200 hover:text-gray-600"]),onClick:t[0]||(t[0]=o=>q(1))},t[15]||(t[15]=[e("i",{class:"fa-solid fa-calendar-days"},null,-1),u(),e("span",{class:"hidden md:block md:ms-4"},"Agendamento",-1)]),2)]),e("li",null,[e("span",{class:_(["text-xs md:text-base flex items-center",y.value===2?"px-5 py-3 bg-white border border-b-0 border-gray-300 cursor-default":"px-5 py-3 bg-gray-300 text-white cursor-pointer hover:bg-gray-200 hover:text-gray-600"]),onClick:t[1]||(t[1]=o=>q(2))},t[16]||(t[16]=[e("i",{class:"fa-solid fa-database"},null,-1),u(),e("span",{class:"hidden md:block md:ms-4"},"Consulta SQL",-1)]),2)]),e("li",null,[e("span",{class:_(["text-xs md:text-base flex items-center",y.value===3?"px-5 py-3 bg-white border border-b-0 border-gray-300 cursor-default":"px-5 py-3 bg-gray-300 text-white cursor-pointer hover:bg-gray-200 hover:text-gray-600"]),onClick:t[2]||(t[2]=o=>q(3))},t[17]||(t[17]=[e("i",{class:"fa-solid fa-envelope-open-text"},null,-1),u(),e("span",{class:"hidden md:block md:ms-4"},"E-mail",-1)]),2)])])])]),e("form",{onSubmit:R(B,["prevent"]),id:"report",class:"bg-white p-4 border border-gray-300 rounded-t-none shadow-lg rounded-md mt-1 md:mt-4"},[y.value===1?(a(),l("div",de,[t[28]||(t[28]=e("h1",{class:"py-6 font-extrabold text-lg"},"Geral",-1)),e("div",ue,[e("div",null,[e("label",ie,[t[18]||(t[18]=e("span",{class:"text-gray-700"},[u("Título "),e("span",{class:"text-red-600"},"**")],-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s(r).report_description=o),type:"text",required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500",placeholder:"Defina um título"},null,512),[[S,s(r).report_description]]),s(r).errors.report_description?(a(),l("p",pe,i(s(r).errors.report_description),1)):p("",!0)])]),e("div",null,[e("label",ye,[t[20]||(t[20]=e("span",{class:"text-gray-700"},[u("Status "),e("span",{class:"text-red-600"},"**")],-1)),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>s(r).status=o),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},t[19]||(t[19]=[e("option",{value:"1"},"Ativo",-1),e("option",{value:"0"},"Inativo",-1)]),512),[[x,s(r).status]]),s(r).errors.status?(a(),l("p",ce,i(s(r).errors.status),1)):p("",!0)])]),e("div",null,[e("label",me,[t[21]||(t[21]=e("span",{class:"text-gray-700"},[u("Grupo de contatos "),e("span",{class:"text-red-600"},"**")],-1)),m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>s(r).group_id=o),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},[(a(!0),l(g,null,f(k.groups,(o,c)=>(a(),l("option",{key:c,value:o.id},i(o.name),9,ge))),128))],512),[[x,s(r).group_id]]),s(r).errors.group_id?(a(),l("p",be,i(s(r).errors.group_id),1)):p("",!0)])])]),e("div",fe,[e("div",null,[e("label",ve,[t[23]||(t[23]=e("span",{class:"text-gray-700"},[u("Tipo de Agendamento "),e("span",{class:"text-red-600"},"**")],-1)),m(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>s(r).scheduleType=o),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},t[22]||(t[22]=[e("option",{value:"daily"},"Diariamente",-1),e("option",{value:"weekly"},"Semanalmente",-1),e("option",{value:"monthly"},"Mensalmente",-1),e("option",{value:"yearly"},"Anualmente",-1)]),512),[[x,s(r).scheduleType]]),s(r).errors.scheduleType?(a(),l("p",xe,i(s(r).errors.scheduleType),1)):p("",!0)])]),e("div",null,[e("label",ke,[t[24]||(t[24]=e("span",{class:"text-gray-700"},[u("Horário "),e("span",{class:"text-red-600"},"**")],-1)),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>s(r).selectedTime=o),type:"time",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},null,512),[[S,s(r).selectedTime]])])]),s(r).scheduleType==="weekly"?(a(),l("div",he,[e("label",we,[t[25]||(t[25]=e("span",{class:"text-gray-700"},"Dia da semana",-1)),m(e("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>s(r).selectedWeekday=o),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},[(a(),l(g,null,f(P,(o,c)=>e("option",{key:c,value:o.value},i(o.label),9,_e)),64))],512),[[x,s(r).selectedWeekday]])])])):p("",!0),s(r).scheduleType==="monthly"||s(r).scheduleType==="yearly"?(a(),l("div",qe,[e("label",Te,[t[26]||(t[26]=e("span",{class:"text-gray-700"},"Dia do mês",-1)),m(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>s(r).selectedDay=o),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},[(a(),l(g,null,f(31,o=>e("option",{key:o,value:o},i(o),9,Se)),64))],512),[[x,s(r).selectedDay]])])])):p("",!0),s(r).scheduleType==="yearly"?(a(),l("div",$e,[e("label",De,[t[27]||(t[27]=e("span",{class:"text-gray-700"},"Mês do ano",-1)),m(e("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>s(r).selectedMonth=o),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500"},[(a(),l(g,null,f(G,(o,c)=>e("option",{key:c,value:o.value},i(o.label),9,Ve)),64))],512),[[x,s(r).selectedMonth]])])])):p("",!0)])])):p("",!0),y.value===2?(a(),l("div",Ce,[t[32]||(t[32]=e("h1",{class:"py-6 font-extrabold text-lg"},"Consulta SQL",-1)),e("div",Me,[e("div",null,[e("label",Ae,[t[29]||(t[29]=e("span",{class:"text-gray-700"},[u("Nome "),e("span",{class:"text-red-600"},"**")],-1)),m(e("input",{"onUpdate:modelValue":t[11]||(t[11]=o=>s(r).query_name=o),type:"text",required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-gray-500",placeholder:"Defina um nome"},null,512),[[S,s(r).query_name]]),s(r).errors.query_name?(a(),l("p",Ee,i(s(r).errors.query_name),1)):p("",!0)])]),e("div",Qe,[e("form",{id:"query",onSubmit:R(K,["prevent"]),class:"w-full"},[t[30]||(t[30]=e("p",{class:"text-gray-700 mb-1"},"Testar consulta SQL",-1)),e("button",{class:_([v.value?"bg-indigo-900":"bg-indigo-600 hover:bg-indigo-700","w-full px-4 py-2 text-white rounded-md text-sm transition duration-300"]),form:"query",type:"submit"},i(v.value?"Consultando...":"Testar"),3)],32)]),e("div",Ue,[e("label",Ne,[t[31]||(t[31]=e("span",{class:"text-gray-700"},[u("Query SQL "),e("span",{class:"text-red-600"},"**")],-1)),s(r).errors.query?(a(),l("p",je,i(s(r).errors.query),1)):p("",!0)]),b(oe,{modelValue:s(r).query,"onUpdate:modelValue":t[12]||(t[12]=o=>s(r).query=o),class:"cursor-text"},null,8,["modelValue"])]),e("div",Fe,[n.errorMsg?(a(),l("div",Oe,i(n.errorMsg),1)):p("",!0),w.value?(a(),l("div",Le,[e("table",We,[e("thead",Je,[e("tr",null,[(a(!0),l(g,null,f(w.value[0],(o,c)=>(a(),l("th",{key:c,class:"px-4 py-1 text-left text-xs uppercase text-gray-600"},i(c),1))),128))])]),e("tbody",null,[(a(!0),l(g,null,f(w.value,(o,c)=>(a(),l("tr",{key:c,class:"hover:bg-gray-50"},[(a(!0),l(g,null,f(o,(X,Z)=>(a(),l("td",{key:Z,class:"px-4 py-2 border-b"},i(X),1))),128))]))),128))])])])):(a(),l("div",Re,"Nenhum dado encontrado."))])])])):p("",!0),y.value===3?(a(),l("div",ze,[t[36]||(t[36]=e("h1",{class:"py-6 font-extrabold text-lg"},"E-mail",-1)),e("div",Be,[e("p",null,[t[33]||(t[33]=u("Assunto: ")),e("span",Pe,i(s(r).report_description),1)]),e("p",null,[t[34]||(t[34]=u("Tipo de agendamento: ")),e("span",Ge,i(s(r).scheduleType),1)])]),e("div",Ie,[t[35]||(t[35]=e("label",{class:"block"},[e("span",{class:"text-gray-700"},[u("Corpo do e-mail "),e("span",{class:"text-red-600"},"**")])],-1)),s(r).errors.message?(a(),l("p",He,i(s(r).errors.message),1)):p("",!0),b(le,{modelValue:s(r).message,"onUpdate:modelValue":t[13]||(t[13]=o=>s(r).message=o)},null,8,["modelValue"])])])):p("",!0),y.value<3?(a(),l("div",Ke,[e("button",{onClick:t[14]||(t[14]=o=>I()),type:"button",class:"bg-red-700 text-white px-4 py-2 rounded-md hover:bg-red-900 w-full sm:w-48"},t[37]||(t[37]=[u(" Próximo "),e("i",{class:"fa-solid fa-arrow-right"},null,-1)])),b(s(z),{href:n.route("report.index"),class:"bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-900 flex justify-center items-center w-full sm:w-48"},{default:T(()=>t[38]||(t[38]=[e("i",{class:"fa-solid fa-trash-can me-2"},null,-1),u(" Cancelar ")])),_:1},8,["href"])])):p("",!0),y.value===3?(a(),l("div",Xe,[t[40]||(t[40]=e("button",{type:"submit",form:"report",class:"bg-red-700 text-white px-4 py-2 rounded-md hover:bg-red-900 w-full sm:w-48"},[e("i",{class:"fa-solid fa-check"}),u(" Salvar ")],-1)),b(s(z),{href:n.route("report.index"),class:"bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-900 flex justify-center items-center w-full sm:w-48"},{default:T(()=>t[39]||(t[39]=[e("i",{class:"fa-solid fa-trash-can me-2"},null,-1),u(" Cancelar ")])),_:1},8,["href"])])):p("",!0)],32)]),_:1},8,["success","error"])],64))}};export{ot as default};
